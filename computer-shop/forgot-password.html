<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forgot Password - Nexus Computer Shop</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header id="header">
        <div class="container header-container">
            <a href="index.html" class="logo">
                <i class="fas fa-microchip logo-icon"></i>
                NEXUS
            </a>

            <nav class="nav-links">
                <a href="products.html">Products</a>
                <a href="features.html">Services</a>
                <a href="custom.html">Custom Builds</a>
                <a href="support.html">Support</a>
            </nav>

            <div class="header-actions">
                <button class="search-btn"><i class="fas fa-search"></i></button>
                <div class="auth-buttons"></div>
                <div class="cart-wrapper">
                    <a href="cart.html" class="cart-btn" style="text-decoration: none; display: flex; align-items: center;"><i class="fas fa-shopping-bag"></i></a>
                    <span class="cart-count">0</span>
                </div>
                <a href="build-your-pc.html" class="cta-btn" style="text-decoration: none; display: inline-block;">Build Your PC</a>
                <button class="mobile-menu-btn"><i class="fas fa-bars"></i></button>
            </div>
        </div>
    </header>

    <!-- Forgot Password Section -->
    <section class="login-section">
        <div class="container">
            <div class="forgot-password-container">
                <div class="forgot-password-header">
                    <div class="icon-circle">
                        <i class="fas fa-lock"></i>
                    </div>
                    <h2>Forgot Password?</h2>
                    <p class="subtitle">No worries! Enter your email address and we'll help you reset your password.</p>
                </div>

                <!-- Step 1: Email Input -->
                <div id="email-step" class="reset-step active">
                    <form id="forgot-password-form" class="auth-form">
                        <div class="form-group">
                            <label for="reset-email">
                                <i class="fas fa-envelope"></i> Email Address
                            </label>
                            <input type="email" id="reset-email" required placeholder="Enter your registered email">
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-paper-plane"></i> Send Reset Code
                        </button>
                        <div class="form-message" id="email-message"></div>
                    </form>
                    <div class="back-to-login">
                        <a href="login.html"><i class="fas fa-arrow-left"></i> Back to Login</a>
                    </div>
                </div>

                <!-- Step 2: Verification Code -->
                <div id="code-step" class="reset-step">
                    <form id="verify-code-form" class="auth-form">
                        <p class="step-info">
                            <i class="fas fa-info-circle"></i> 
                            We've sent a 6-digit code to <strong id="sent-email"></strong>
                        </p>
                        <div class="form-group">
                            <label for="verification-code">
                                <i class="fas fa-key"></i> Verification Code
                            </label>
                            <input type="text" id="verification-code" required placeholder="Enter 6-digit code" maxlength="6" pattern="[0-9]{6}">
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-check"></i> Verify Code
                        </button>
                        <div class="form-message" id="code-message"></div>
                        <div class="resend-code">
                            <p>Didn't receive the code? <button type="button" id="resend-btn" class="link-btn">Resend</button></p>
                        </div>
                    </form>
                </div>

                <!-- Step 3: New Password -->
                <div id="password-step" class="reset-step">
                    <form id="new-password-form" class="auth-form">
                        <p class="step-info success">
                            <i class="fas fa-check-circle"></i> 
                            Code verified! Now set your new password.
                        </p>
                        <div class="form-group">
                            <label for="new-password">
                                <i class="fas fa-lock"></i> New Password
                            </label>
                            <input type="password" id="new-password" required placeholder="Enter new password (min 6 characters)" minlength="6">
                        </div>
                        <div class="form-group">
                            <label for="confirm-password">
                                <i class="fas fa-lock"></i> Confirm Password
                            </label>
                            <input type="password" id="confirm-password" required placeholder="Confirm your new password">
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Reset Password
                        </button>
                        <div class="form-message" id="password-message"></div>
                    </form>
                </div>

                <!-- Step 4: Success -->
                <div id="success-step" class="reset-step">
                    <div class="success-content">
                        <div class="success-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h3>Password Reset Successful!</h3>
                        <p>Your password has been successfully reset. You can now login with your new password.</p>
                        <a href="login.html" class="btn btn-primary">
                            <i class="fas fa-sign-in-alt"></i> Go to Login
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>About Nexus</h3>
                    <p>Your trusted partner for high-performance computer systems and components.</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="products.html">Products</a></li>
                        <li><a href="build-your-pc.html">Build PC</a></li>
                        <li><a href="custom.html">Custom Build</a></li>
                        <li><a href="support.html">Support</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Customer Service</h3>
                    <ul>
                        <li><a href="#">Shipping Info</a></li>
                        <li><a href="#">Returns</a></li>
                        <li><a href="#">Warranty</a></li>
                        <li><a href="#">FAQ</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Contact Us</h3>
                    <p><i class="fas fa-phone"></i> +1 (555) 123-4567</p>
                    <p><i class="fas fa-envelope"></i> support@nexuspc.com</p>
                    <p><i class="fas fa-map-marker-alt"></i> 123 Tech Street, Silicon Valley</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2026 Nexus Computer Shop. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="js/search.js"></script>
    <script src="js/currency.js"></script>
    <script src="js/cart.js"></script>
    <script src="js/auth.js"></script>
    <script>
        let currentStep = 1;
        let userEmail = '';
        let verificationCode = '';

        // Redirect if already logged in
        if (auth.isLoggedIn()) {
            window.location.href = 'dashboard.html';
        }

        // Step 1: Send reset code
        document.getElementById('forgot-password-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const email = document.getElementById('reset-email').value;
            const messageEl = document.getElementById('email-message');

            // Check if email exists in system
            const users = auth.getAllUsers();
            const user = users.find(u => u.email === email);

            if (!user) {
                messageEl.className = 'form-message error';
                messageEl.textContent = 'No account found with this email address.';
                return;
            }

            // Generate 6-digit code
            verificationCode = Math.floor(100000 + Math.random() * 900000).toString();
            userEmail = email;

            // In a real application, this would send an email
            console.log('Verification Code:', verificationCode);
            
            messageEl.className = 'form-message success';
            messageEl.textContent = 'Verification code sent! (Check console for demo code)';

            // Move to next step
            setTimeout(() => {
                showStep(2);
                document.getElementById('sent-email').textContent = email;
            }, 1500);
        });

        // Step 2: Verify code
        document.getElementById('verify-code-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const enteredCode = document.getElementById('verification-code').value;
            const messageEl = document.getElementById('code-message');

            if (enteredCode !== verificationCode) {
                messageEl.className = 'form-message error';
                messageEl.textContent = 'Invalid verification code. Please try again.';
                return;
            }

            messageEl.className = 'form-message success';
            messageEl.textContent = 'Code verified successfully!';

            setTimeout(() => {
                showStep(3);
            }, 1000);
        });

        // Resend code
        document.getElementById('resend-btn').addEventListener('click', function() {
            verificationCode = Math.floor(100000 + Math.random() * 900000).toString();
            console.log('New Verification Code:', verificationCode);
            
            const messageEl = document.getElementById('code-message');
            messageEl.className = 'form-message success';
            messageEl.textContent = 'New code sent! (Check console for demo code)';
            
            setTimeout(() => {
                messageEl.textContent = '';
                messageEl.className = 'form-message';
            }, 3000);
        });

        // Step 3: Reset password
        document.getElementById('new-password-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            const messageEl = document.getElementById('password-message');

            if (newPassword !== confirmPassword) {
                messageEl.className = 'form-message error';
                messageEl.textContent = 'Passwords do not match!';
                return;
            }

            if (newPassword.length < 6) {
                messageEl.className = 'form-message error';
                messageEl.textContent = 'Password must be at least 6 characters!';
                return;
            }

            // Update password in storage
            const users = auth.getAllUsers();
            const userIndex = users.findIndex(u => u.email === userEmail);

            if (userIndex !== -1) {
                users[userIndex].password = newPassword;
                auth.saveAllUsers(users);

                messageEl.className = 'form-message success';
                messageEl.textContent = 'Password updated successfully!';

                setTimeout(() => {
                    showStep(4);
                }, 1000);
            } else {
                messageEl.className = 'form-message error';
                messageEl.textContent = 'An error occurred. Please try again.';
            }
        });

        // Show specific step
        function showStep(stepNumber) {
            document.querySelectorAll('.reset-step').forEach(step => {
                step.classList.remove('active');
            });

            const steps = ['email-step', 'code-step', 'password-step', 'success-step'];
            document.getElementById(steps[stepNumber - 1]).classList.add('active');
            currentStep = stepNumber;
        }
    </script>
</body>
</html>
